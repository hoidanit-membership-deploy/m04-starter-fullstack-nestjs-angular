<!--
  Author: Hỏi Dân IT - @hoidanit

  This source code is developed for the course
  "Deploy Siêu Tốc".
  It is intended for educational purposes only.
  Unauthorized distribution, reproduction, or modification is strictly prohibited.

  Copyright (c) 2026 Hỏi Dân IT. All Rights Reserved.
-->

<div class="fixed inset-0 bg-gray-900/60 backdrop-blur-sm flex items-center justify-center z-50 p-4">
  <div class="bg-white rounded-2xl shadow-2xl w-full max-w-lg transform transition-all animate-fadeIn">
    <!-- Header -->
    <div class="relative bg-gradient-to-r from-indigo-600 to-purple-600 rounded-t-2xl px-6 py-5">
      <div class="flex items-center gap-3">
        <div class="w-10 h-10 bg-white/20 rounded-xl flex items-center justify-center">
          <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            @if (isEditing) {
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
            } @else {
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
            }
          </svg>
        </div>
        <h2 class="text-xl font-semibold text-white">
          {{ isEditing ? 'Chỉnh sửa Todo' : 'Tạo Todo Mới' }}
        </h2>
      </div>
      <button
        (click)="onClose()"
        class="absolute top-4 right-4 w-8 h-8 flex items-center justify-center rounded-lg bg-white/10 hover:bg-white/20 text-white transition-colors"
      >
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
        </svg>
      </button>
    </div>

    <!-- Form -->
    <form [formGroup]="todoForm" (ngSubmit)="onSubmit()" class="p-6">
      @if (error()) {
        <div class="flex items-center gap-3 bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-xl mb-5">
          <svg class="w-5 h-5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
          </svg>
          <span class="text-sm">{{ error() }}</span>
        </div>
      }

      <div class="mb-5">
        <label for="title" class="block text-gray-700 text-sm font-medium mb-2">
          Tiêu đề <span class="text-red-500">*</span>
        </label>
        <input
          type="text"
          id="title"
          formControlName="title"
          class="w-full px-4 py-3 bg-gray-50 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent focus:bg-white transition-all"
          placeholder="Nhập tiêu đề công việc..."
        />
        @if (todoForm.get('title')?.invalid && todoForm.get('title')?.touched) {
          <p class="flex items-center gap-1 text-red-500 text-xs mt-2">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
            </svg>
            Tiêu đề không được để trống
          </p>
        }
      </div>

      <div class="mb-6">
        <label for="description" class="block text-gray-700 text-sm font-medium mb-2">
          Mô tả <span class="text-gray-400 font-normal">(tùy chọn)</span>
        </label>
        <textarea
          id="description"
          formControlName="description"
          rows="4"
          class="w-full px-4 py-3 bg-gray-50 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent focus:bg-white transition-all resize-none"
          placeholder="Thêm mô tả chi tiết cho công việc..."
        ></textarea>
      </div>

      <div class="flex gap-3 pt-2">
        <button
          type="button"
          (click)="onClose()"
          class="flex-1 px-5 py-3 bg-gray-100 text-gray-700 font-medium rounded-xl hover:bg-gray-200 transition-colors"
        >
          Hủy bỏ
        </button>
        <button
          type="submit"
          [disabled]="loading() || todoForm.invalid"
          class="flex-1 px-5 py-3 bg-gradient-to-r from-indigo-600 to-purple-600 text-white font-medium rounded-xl hover:from-indigo-700 hover:to-purple-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all shadow-lg shadow-indigo-500/30 hover:shadow-indigo-500/40"
        >
          @if (loading()) {
            <span class="flex items-center justify-center gap-2">
              <svg class="w-5 h-5 animate-spin" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
              </svg>
              Đang lưu...
            </span>
          } @else {
            <span>{{ isEditing ? 'Cập nhật' : 'Tạo mới' }}</span>
          }
        </button>
      </div>
    </form>
  </div>
</div>
